@model DeviceDto
@using StationPro.Domain.Entities
@using Microsoft.Extensions.Localization
@using StationPro
@inject IStringLocalizer<SharedResources> Localizer

@{
    var statusClass = Model.Status == "Available" ? "available" :
                     Model.Status == "In Use" ? "in-use" :
                     Model.Status == "Maintenance" ? "maintenance" : "offline";
    var statusFilter = Model.Status == "Available" ? "available" :
                      Model.Status == "In Use" ? "in-use" :
                      Model.Status == "Maintenance" ? "maintenance" : "offline";
    var iconBgClass = Model.Status == "Available" ? "bg-green-100" :
                     Model.Status == "In Use" ? "bg-red-100" :
                     Model.Status == "Maintenance" ? "bg-yellow-100" : "bg-gray-100";
    var iconColorClass = Model.Status == "Available" ? "text-green-600" :
                        Model.Status == "In Use" ? "text-red-600" :
                        Model.Status == "Maintenance" ? "text-yellow-600" : "text-gray-600";
    var statusBadgeClass = Model.Status == "Available" ? "status-available" :
                          Model.Status == "In Use" ? "status-in-use" :
                          Model.Status == "Maintenance" ? "status-maintenance" : "status-offline";
    var deviceIconClass = ((int)Model.Type == 1 || (int)Model.Type == 2 || (int)Model.Type == 3) ? "fab fa-playstation" :
                         (int)Model.Type == 4 ? "fab fa-xbox" :
                         (int)Model.Type == 5 ? "fas fa-desktop" :
                         (int)Model.Type == 6 ? "fas fa-table-tennis" :
                         ((int)Model.Type == 7 || (int)Model.Type == 8) ? "fas fa-circle" : "fas fa-gamepad";
}

<div class="device-card @statusClass fade-in"
     data-device-name="@Model.Name.ToLower()"
     data-device-status="@statusFilter"
     data-device-id="@Model.Id">

    <!-- Device Header -->
    <div class="flex justify-between items-start mb-4">
        <div class="flex items-center space-x-3">
            <div class="@iconBgClass p-3 rounded-xl">
                <i class="@deviceIconClass @iconColorClass text-2xl"></i>
            </div>
            <div>
                <h3 class="font-bold text-lg text-gray-900">@Model.Name</h3>
                <p class="text-sm text-gray-500">@Model.TypeName</p>
            </div>
        </div>

        <!-- Status Badge -->
        <span class="status-badge @statusBadgeClass">
             @Localizer[Model.StatusName]
        </span>
    </div>

    <!-- Device Details -->
    <div class="border-t border-gray-100 pt-4 mb-4 space-y-3">
        <div class="flex justify-between items-center">
            <span class="text-sm text-gray-600">@Localizer["HourlyRate"]</span>
            <span class="text-lg font-bold text-blue-600">@Model.HourlyRate.ToString("C")</span>
        </div>

        @if (Model.CurrentSession != null)
        {
            <div class="bg-red-50 p-3 rounded-lg border-l-4 border-red-500">
                <p class="text-xs text-gray-600 mb-1">@Localizer["ActiveSession"]</p>
                <div class="flex justify-between items-center mb-2">
                    <span class="text-sm font-medium">
                        @(string.IsNullOrEmpty(Model.CurrentSession.CustomerName) ? Localizer["Guest"] : Model.CurrentSession.CustomerName)
                    </span>
                    <!-- DYNAMIC COST - Updated by JavaScript timer -->
                    <span class="text-sm font-bold text-green-600" id="cost-@Model.CurrentSession.Id">
                        @Model.CurrentSession.TotalCost.ToString("C")
                    </span>
                </div>
                <div class="flex items-center justify-between text-xs text-gray-500">
                    <!-- LIVE TIMER - Critical for session-timer.js! -->
                    <span>
                        <i class="fas fa-clock mr-1"></i>
                        <span class="font-mono font-bold text-blue-600"
                              id="timer-@Model.CurrentSession.Id"
                              data-start-time="@Model.CurrentSession.StartTime.ToString("o")"
                              data-hourly-rate="@Model.CurrentSession.HourlyRate">
                            @Model.CurrentSession.DurationFormatted
                        </span>
                    </span>
                    <span>@Model.CurrentSession.HourlyRate.ToString("C")/@Localizer["hr"]</span>
                </div>
            </div>
        }
    </div>

    <!-- Actions -->
    <div class="flex space-x-2">
        @if (Model.Status == "Available")
        {
            <button onclick="quickStartDeviceSession(@Model.Id, '@Model.Name')"
                    class="btn btn-success flex-1">
                <i class="fas fa-play mr-2"></i>
                @Localizer["Start"]
            </button>
        }
        else if (Model.Status == "In Use")
        {
            <button class="btn btn-secondary flex-1 opacity-50 cursor-not-allowed" disabled>
                <i class="fas fa-spinner fa-pulse mr-2"></i>
                @Localizer["InUse"]
            </button>
        }
        else
        {
            <button class="btn btn-secondary flex-1 opacity-50 cursor-not-allowed" disabled>
                <i class="fas fa-tools mr-2"></i>
                @Model.StatusName
            </button>
        }

        <button onclick="editDevice(@Model.Id)"
                class="btn btn-outline">
            <i class="fas fa-edit"></i>
        </button>
        <button onclick="deleteDevice(@Model.Id, '@Model.Name')"
                class="btn btn-danger">
            <i class="fas fa-trash"></i>
        </button>
    </div>
</div>
@model SessionReportDto
@using Microsoft.Extensions.Localization
@using StationPro
@inject IStringLocalizer<SharedResources> Localizer

<div class="modal-header">
    <h3 class="text-2xl font-bold text-gray-900">
        <i class="fas fa-info-circle text-blue-600"></i>
        @Localizer["SessionDetails"]
    </h3>
    <button onclick="closeModal('session-details-modal')" class="text-gray-400 hover:text-gray-600">
        <i class="fas fa-times text-xl"></i>
    </button>
</div>

<div class="modal-body">
    <!-- Session Status Banner -->
    <div class="mb-6 p-4 rounded-lg @(Model.Status == "Active" ? "bg-green-50 border border-green-200" : "bg-blue-50 border border-blue-200")">
        <div class="flex items-center justify-between">
            <div class="flex items-center gap-3">
                @if (Model.Status == "Active")
                {
                    <div class="bg-green-500 w-3 h-3 rounded-full animate-pulse"></div>
                    <span class="font-semibold text-green-700">@Localizer["SessionActive"]</span>
                }
                else
                {
                    <div class="bg-blue-500 w-3 h-3 rounded-full"></div>
                    <span class="font-semibold text-blue-700">@Localizer["SessionCompleted"]</span>
                }
            </div>
            <span class="text-sm text-gray-600">@Localizer["SessionID"]: #@Model.Id</span>
        </div>
    </div>

    <!-- Device Information -->
    <div class="mb-6">
        <h4 class="text-lg font-bold text-gray-900 mb-3 flex items-center gap-2">
            <i class="fas fa-gamepad text-blue-600"></i>
            @Localizer["DeviceInformation"]
        </h4>
        <div class="bg-gray-50 rounded-lg p-4 space-y-3">
            <div class="flex justify-between items-center">
                <span class="text-gray-600">@Localizer["Device"]:</span>
                <span class="font-semibold text-gray-900">@Model.DeviceName</span>
            </div>
            <div class="flex justify-between items-center">
                <span class="text-gray-600">@Localizer["Type"]:</span>
                <span class="font-semibold text-gray-900">@Model.DeviceType</span>
            </div>
            <div class="flex justify-between items-center">
                <span class="text-gray-600">@Localizer["HourlyRate"]:</span>
                <span class="font-bold text-blue-600">@Model.HourlyRate.ToString("C")/@Localizer["hr"]</span>
            </div>
        </div>
    </div>

    <!-- Customer Information -->
    <div class="mb-6">
        <h4 class="text-lg font-bold text-gray-900 mb-3 flex items-center gap-2">
            <i class="fas fa-user text-purple-600"></i>
            @Localizer["CustomerInformation"]
        </h4>
        <div class="bg-gray-50 rounded-lg p-4 space-y-3">
            <div class="flex justify-between items-center">
                <span class="text-gray-600">@Localizer["Name"]:</span>
                @if (!string.IsNullOrEmpty(Model.CustomerName))
                {
                    <span class="font-semibold text-gray-900">@Model.CustomerName</span>
                }
                else
                {
                    <span class="text-gray-500 italic">@Localizer["Guest"]</span>
                }
            </div>
        </div>
    </div>

    <!-- Session Timeline -->
    <div class="mb-6">
        <h4 class="text-lg font-bold text-gray-900 mb-3 flex items-center gap-2">
            <i class="fas fa-clock text-orange-600"></i>
            @Localizer["SessionTimeline"]
        </h4>
        <div class="relative timeline-container">
            <!-- Timeline line -->
            <div class="timeline-line absolute left-4 top-8 bottom-8 w-0.5 bg-gray-300"></div>

            <!-- Start Time -->
            <div class="relative timeline-item pl-12 pb-6">
                <div class="timeline-icon absolute left-0 top-0 w-8 h-8 bg-green-500 rounded-full flex items-center justify-center">
                    <i class="fas fa-play text-white text-sm"></i>
                </div>
                <div class="timeline-content">
                    <p class="font-semibold text-gray-900">@Localizer["SessionStarted"]</p>
                    <p class="text-sm text-gray-600">@Model.StartTime.ToString("MMM dd, yyyy - h:mm tt")</p>
                </div>
            </div>

            <!-- Duration -->
            <div class="relative timeline-item pl-12 pb-6">
                <div class="timeline-icon absolute left-0 top-0 w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center">
                    <i class="fas fa-hourglass-half text-white text-sm"></i>
                </div>
                <div class="timeline-content">
                    <p class="font-semibold text-gray-900">@Localizer["Duration"]</p>

                    <div class="text-2xl font-mono font-bold text-blue-600"
                       id="timer-@Model.Id"
                       data-start-time="@Model.StartTime.ToString("o")"
                       data-hourly-rate="@Model.HourlyRate">@Model.DurationFormatted</div>
                    @{
                        var hours = (int)Model.Duration.TotalHours;
                        var minutes = Model.Duration.Minutes;
                        var isRtl = System.Globalization.CultureInfo.CurrentCulture.TextInfo.IsRightToLeft;
                    }
                    @if (isRtl)
                    {
                        <p class="text-xs text-gray-500 mt-1">
                            @minutes @Localizer["minutes"] @hours @Localizer["hours"]
                        </p>
                    }
                    else
                    {
                        <p class="text-xs text-gray-500 mt-1">
                            @hours @Localizer["hours"] @minutes @Localizer["minutes"]
                        </p>
                    }
                </div>
            </div>

            <!-- End Time -->
            @if (Model.EndTime.HasValue)
            {
                <div class="relative timeline-item pl-12">
                    <div class="timeline-icon absolute left-0 top-0 w-8 h-8 bg-red-500 rounded-full flex items-center justify-center">
                        <i class="fas fa-stop text-white text-sm"></i>
                    </div>
                    <div class="timeline-content">
                        <p class="font-semibold text-gray-900">@Localizer["SessionEnded"]</p>
                        <p class="text-sm text-gray-600">@Model.EndTime.Value.ToString("MMM dd, yyyy - h:mm tt")</p>
                    </div>
                </div>
            }
        </div>
    </div>

    <!-- Payment Summary -->
    <div class="bg-gradient-to-br from-green-50 to-emerald-50 rounded-lg p-6 border-2 border-green-200">
        <h4 class="text-lg font-bold text-gray-900 mb-4 flex items-center gap-2">
            <i class="fas fa-receipt text-green-600"></i>
            @Localizer["PaymentSummary"]
        </h4>
        <div class="space-y-3">
            <div class="flex justify-between items-center text-gray-700">
                <span>@Localizer["Duration"]:</span>
                <span class="font-mono font-semibold">@Model.DurationFormatted</span>
            </div>
            <div class="flex justify-between items-center text-gray-700">
                <span>@Localizer["Rate"]:</span>
                <span class="font-semibold">@Model.HourlyRate.ToString("C")/@Localizer["hr"]</span>
            </div>
            <div class="flex justify-between items-center text-gray-700">
                <span>@Localizer["PaymentMethod"]:</span>
                <span class="font-semibold">@Model.PaymentMethod</span>
            </div>
            <div class="pt-3 border-t-2 border-green-300">
                <div class="flex justify-between items-center">
                    <span class="text-xl font-bold text-gray-900">@Localizer["TotalCost"]:</span>
                    <span class="text-3xl font-bold text-green-600" id="cost-@Model.Id">@Model.TotalCost.ToString("C")</span>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal-footer">
    <button onclick="closeModal('session-details-modal')" class="btn btn-secondary">
        <i class="fas fa-times"></i>
        @Localizer["Close"]
    </button>
    @if (Model.Status == "Completed")
    {
        <button onclick="printReceipt(@Model.Id); closeModal('session-details-modal');" class="btn btn-primary">
            <i class="fas fa-print"></i>
            @Localizer["PrintReceipt"]
        </button>
    }
</div>